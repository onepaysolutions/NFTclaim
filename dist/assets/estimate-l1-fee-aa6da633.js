import{B as u,bi as I,aa as P,s as U,bk as J,b as w,I as v,bz as Q,bA as X,az as A,p as a,al as F,bB as E,T as Z,a1 as ee,r as te}from"./index-cd4a7b3c.js";import{s as ne,t as p}from"./sha256-9d9d2165.js";const oe={ether:-9,wei:9};function se(e,t){let n=e.toString();const o=n.startsWith("-");o&&(n=n.slice(1)),n=n.padStart(t,"0");let[s,r]=[n.slice(0,n.length-t),n.slice(n.length-t)];return r=r.replace(/(0+)$/,""),`${o?"-":""}${s||"0"}${r?`.${r}`:""}`}function B(e,t="wei"){return se(e,oe[t])}function re(e){const t=Object.entries(e).map(([o,s])=>s===void 0||s===!1?null:[o,s]).filter(Boolean),n=t.reduce((o,[s])=>Math.max(o,s.length),0);return t.map(([o,s])=>`  ${`${o}:`.padEnd(n+1)}  ${s}`).join(`
`)}class ie extends u{constructor({v:t}){super(`Invalid \`v\` value "${t}". Expected 27 or 28.`,{name:"InvalidLegacyVError"})}}class ae extends u{constructor({transaction:t}){super("Cannot infer a transaction type from provided transaction.",{metaMessages:["Provided Transaction:","{",re(t),"}","","To infer the type, either provide:","- a `type` to the Transaction, or","- an EIP-1559 Transaction with `maxFeePerGas`, or","- an EIP-2930 Transaction with `gasPrice` & `accessList`, or","- an EIP-4844 Transaction with `blobs`, `blobVersionedHashes`, `sidecars`, or","- an EIP-7702 Transaction with `authorizationList`, or","- a Legacy Transaction with `gasPrice`"],name:"InvalidSerializableTransactionError"})}}class ce extends u{constructor({storageKey:t}){super(`Size for storage key "${t}" is invalid. Expected 32 bytes. Got ${Math.floor((t.length-2)/2)} bytes.`,{name:"InvalidStorageKeySizeError"})}}class G extends u{constructor({cause:t,maxFeePerGas:n}={}){super(`The fee cap (\`maxFeePerGas\`${n?` = ${B(n)} gwei`:""}) cannot be higher than the maximum allowed value (2^256-1).`,{cause:t,name:"FeeCapTooHighError"})}}Object.defineProperty(G,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/max fee per gas higher than 2\^256-1|fee cap higher than 2\^256-1/});class _ extends u{constructor({cause:t,maxPriorityFeePerGas:n,maxFeePerGas:o}={}){super([`The provided tip (\`maxPriorityFeePerGas\`${n?` = ${B(n)} gwei`:""}) cannot be higher than the fee cap (\`maxFeePerGas\`${o?` = ${B(o)} gwei`:""}).`].join(`
`),{cause:t,name:"TipAboveFeeCapError"})}}Object.defineProperty(_,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/max priority fee per gas higher than max fee per gas|tip higher than fee cap/});function R(e){const{kzg:t}=e,n=e.to??(typeof e.blobs[0]=="string"?"hex":"bytes"),o=typeof e.blobs[0]=="string"?e.blobs.map(r=>I(r)):e.blobs,s=[];for(const r of o)s.push(Uint8Array.from(t.blobToKzgCommitment(r)));return n==="bytes"?s:s.map(r=>P(r))}function D(e){const{kzg:t}=e,n=e.to??(typeof e.blobs[0]=="string"?"hex":"bytes"),o=typeof e.blobs[0]=="string"?e.blobs.map(i=>I(i)):e.blobs,s=typeof e.commitments[0]=="string"?e.commitments.map(i=>I(i)):e.commitments,r=[];for(let i=0;i<o.length;i++){const c=o[i],f=s[i];r.push(Uint8Array.from(t.computeBlobKzgProof(c,f)))}return n==="bytes"?r:r.map(i=>P(i))}function fe(e){const{commitment:t,version:n=1}=e,o=e.to??(typeof t=="string"?"hex":"bytes"),s=ne(t,"bytes");return s.set([n],0),o==="bytes"?s:P(s)}function de(e){const{commitments:t,version:n}=e,o=e.to??(typeof t[0]=="string"?"hex":"bytes"),s=[];for(const r of t)s.push(fe({commitment:r,to:o,version:n}));return s}const K=6,N=32,H=4096,W=N*H,O=W*K-1-1*H*K,Y=1;class le extends u{constructor({maxSize:t,size:n}){super("Blob size is too large.",{metaMessages:[`Max: ${t} bytes`,`Given: ${n} bytes`],name:"BlobSizeTooLargeError"})}}class q extends u{constructor(){super("Blob data must not be empty.",{name:"EmptyBlobError"})}}class ue extends u{constructor({hash:t,size:n}){super(`Versioned hash "${t}" size is invalid.`,{metaMessages:["Expected: 32",`Received: ${n}`],name:"InvalidVersionedHashSizeError"})}}class he extends u{constructor({hash:t,version:n}){super(`Versioned hash "${t}" version is invalid.`,{metaMessages:[`Expected: ${Y}`,`Received: ${n}`],name:"InvalidVersionedHashVersionError"})}}function be(e){const t=e.to??(typeof e.data=="string"?"hex":"bytes"),n=typeof e.data=="string"?I(e.data):e.data,o=U(n);if(!o)throw new q;if(o>O)throw new le({maxSize:O,size:o});const s=[];let r=!0,i=0;for(;r;){const c=J(new Uint8Array(W));let f=0;for(;f<H;){const d=n.slice(i,i+(N-1));if(c.pushByte(0),c.pushBytes(d),d.length<31){c.pushByte(128),r=!1;break}f++,i+=31}s.push(c)}return t==="bytes"?s.map(c=>c.bytes):s.map(c=>P(c.bytes))}function me(e){const{data:t,kzg:n,to:o}=e,s=e.blobs??be({data:t,to:o}),r=e.commitments??R({blobs:s,kzg:n,to:o}),i=e.proofs??D({blobs:s,commitments:r,kzg:n,to:o}),c=[];for(let f=0;f<s.length;f++)c.push({blob:s[f],commitment:r[f],proof:i[f]});return c}function xe(e){if(e.type)return e.type;if(typeof e.authorizationList<"u")return"eip7702";if(typeof e.blobs<"u"||typeof e.blobVersionedHashes<"u"||typeof e.maxFeePerBlobGas<"u"||typeof e.sidecars<"u")return"eip4844";if(typeof e.maxFeePerGas<"u"||typeof e.maxPriorityFeePerGas<"u")return"eip1559";if(typeof e.gasPrice<"u")return typeof e.accessList<"u"?"eip2930":"legacy";throw new ae({transaction:e})}class L extends u{constructor({chainId:t}){super(typeof t=="number"?`Chain ID "${t}" is invalid.`:"Chain ID is invalid.",{name:"InvalidChainIdError"})}}function pe(e){const{authorizationList:t}=e;if(t)for(const n of t){const{contractAddress:o,chainId:s}=n;if(!w(o))throw new v({address:o});if(s<0)throw new L({chainId:s})}S(e)}function ye(e){const{blobVersionedHashes:t}=e;if(t){if(t.length===0)throw new q;for(const n of t){const o=U(n),s=Q(X(n,0,1));if(o!==32)throw new ue({hash:n,size:o});if(s!==Y)throw new he({hash:n,version:s})}}S(e)}function S(e){const{chainId:t,maxPriorityFeePerGas:n,maxFeePerGas:o,to:s}=e;if(t<=0)throw new L({chainId:t});if(s&&!w(s))throw new v({address:s});if(o&&o>A)throw new G({maxFeePerGas:o});if(n&&o&&n>o)throw new _({maxFeePerGas:o,maxPriorityFeePerGas:n})}function ge(e){const{chainId:t,maxPriorityFeePerGas:n,gasPrice:o,maxFeePerGas:s,to:r}=e;if(t<=0)throw new L({chainId:t});if(r&&!w(r))throw new v({address:r});if(n||s)throw new u("`maxFeePerGas`/`maxPriorityFeePerGas` is not a valid EIP-2930 Transaction attribute.");if(o&&o>A)throw new G({maxFeePerGas:o})}function Pe(e){const{chainId:t,maxPriorityFeePerGas:n,gasPrice:o,maxFeePerGas:s,to:r}=e;if(r&&!w(r))throw new v({address:r});if(typeof t<"u"&&t<=0)throw new L({chainId:t});if(n||s)throw new u("`maxFeePerGas`/`maxPriorityFeePerGas` is not a valid Legacy Transaction attribute.");if(o&&o>A)throw new G({maxFeePerGas:o})}function we(e){if(!e||e.length===0)return[];const t=[];for(const n of e){const{contractAddress:o,chainId:s,nonce:r,...i}=n;t.push([s?a(s):"0x",o,r?a(r):"0x",...z({},i)])}return t}function $(e){if(!e||e.length===0)return[];const t=[];for(let n=0;n<e.length;n++){const{address:o,storageKeys:s}=e[n];for(let r=0;r<s.length;r++)if(s[r].length-2!==64)throw new ce({storageKey:s[r]});if(!w(o,{strict:!1}))throw new v({address:o});t.push([o,s])}return t}function ve(e,t){const n=xe(e);return n==="eip1559"?Ie(e,t):n==="eip2930"?Ee(e,t):n==="eip4844"?Te(e,t):n==="eip7702"?ze(e,t):Fe(e,t)}function ze(e,t){const{authorizationList:n,chainId:o,gas:s,nonce:r,to:i,value:c,maxFeePerGas:f,maxPriorityFeePerGas:d,accessList:m,data:b}=e;pe(e);const h=$(m),l=we(n);return F(["0x04",p([a(o),r?a(r):"0x",d?a(d):"0x",f?a(f):"0x",s?a(s):"0x",i??"0x",c?a(c):"0x",b??"0x",h,l,...z(e,t)])])}function Te(e,t){const{chainId:n,gas:o,nonce:s,to:r,value:i,maxFeePerBlobGas:c,maxFeePerGas:f,maxPriorityFeePerGas:d,accessList:m,data:b}=e;ye(e);let h=e.blobVersionedHashes,l=e.sidecars;if(e.blobs&&(typeof h>"u"||typeof l>"u")){const x=typeof e.blobs[0]=="string"?e.blobs:e.blobs.map(g=>P(g)),T=e.kzg,y=R({blobs:x,kzg:T});if(typeof h>"u"&&(h=de({commitments:y})),typeof l>"u"){const g=D({blobs:x,commitments:y,kzg:T});l=me({blobs:x,commitments:y,proofs:g})}}const V=$(m),C=[a(n),s?a(s):"0x",d?a(d):"0x",f?a(f):"0x",o?a(o):"0x",r??"0x",i?a(i):"0x",b??"0x",V,c?a(c):"0x",h??[],...z(e,t)],k=[],M=[],j=[];if(l)for(let x=0;x<l.length;x++){const{blob:T,commitment:y,proof:g}=l[x];k.push(T),M.push(y),j.push(g)}return F(["0x03",l?p([C,k,M,j]):p(C)])}function Ie(e,t){const{chainId:n,gas:o,nonce:s,to:r,value:i,maxFeePerGas:c,maxPriorityFeePerGas:f,accessList:d,data:m}=e;S(e);const b=$(d),h=[a(n),s?a(s):"0x",f?a(f):"0x",c?a(c):"0x",o?a(o):"0x",r??"0x",i?a(i):"0x",m??"0x",b,...z(e,t)];return F(["0x02",p(h)])}function Ee(e,t){const{chainId:n,gas:o,data:s,nonce:r,to:i,value:c,accessList:f,gasPrice:d}=e;ge(e);const m=$(f),b=[a(n),r?a(r):"0x",d?a(d):"0x",o?a(o):"0x",i??"0x",c?a(c):"0x",s??"0x",m,...z(e,t)];return F(["0x01",p(b)])}function Fe(e,t){const{chainId:n=0,gas:o,data:s,nonce:r,to:i,value:c,gasPrice:f}=e;Pe(e);let d=[r?a(r):"0x",f?a(f):"0x",o?a(o):"0x",i??"0x",c?a(c):"0x",s??"0x"];if(t){const m=(()=>{if(t.v>=35n)return(t.v-35n)/2n>0?t.v:27n+(t.v===35n?0n:1n);if(n>0)return BigInt(n*2)+BigInt(35n+t.v-27n);const l=27n+(t.v===27n?0n:1n);if(t.v!==l)throw new ie({v:t.v});return l})(),b=E(t.r),h=E(t.s);d=[...d,a(m),b==="0x00"?"0x":b,h==="0x00"?"0x":h]}else n>0&&(d=[...d,a(n),"0x","0x"]);return p(d)}function z(e,t){const n=t??e,{v:o,yParity:s}=n;if(typeof n.r>"u")return[];if(typeof n.s>"u")return[];if(typeof o>"u"&&typeof s>"u")return[];const r=E(n.r),i=E(n.s);return[(()=>typeof s=="number"?s?a(1):"0x":o===0n?"0x":o===1n?a(1):o===27n?"0x":a(1))(),r==="0x00"?"0x":r,i==="0x00"?"0x":i]}const Ge="0x420000000000000000000000000000000000000F";async function Be(e){const{transaction:t,gasPriceOracleAddress:n}=e,o=Z({client:t.client,address:n||Ge,chain:t.chain}),{gasPrice:s,...r}=await ee({transaction:t}),i=ve({...r,type:"eip1559"});return te({contract:o,method:"function getL1Fee(bytes memory _data) view returns (uint256)",params:[i]})}export{Be as estimateL1Fee};
